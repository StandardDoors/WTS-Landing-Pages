---
id: secrets_management_direnv
description: "Modern secrets management using direnv with organized ~/.config/secrets/ structure"
---

# Secrets Management with direnv

Use direnv for project-specific, context-aware secrets management with organized file structure in `~/.config/secrets/`.

## File Organization

```
~/.config/secrets/
├── personal.env           # Personal API keys (Dropbox, Trakt.tv, etc.)
├── unito.env              # Work-related API keys (OpenAI, Airtable, etc.)
└── credentials/           # JSON/binary credential files (service accounts)
    └── *.json
```

## ✅ DO

**Environment File Format**
- Use `KEY=value` format without `export` statements
- No quotes needed unless value contains spaces or special chars
- Group related secrets with comments
- One environment variable per line

**Project Setup**
- Create `.envrc` files in project directories to load secrets using `~/.config/scripts/export-secret`
- Secrets are NOT sourced directly - use the `export-secret` helper to selectively export variables
- Use `~/.config/secrets/personal.env` for personal projects
- Use `~/.config/secrets/unito.env` for work projects

**Security Practices**
- Never commit `.envrc` files to version control (add to `.gitignore`)
- Use full paths for credential files: `GOOGLE_APPLICATION_CREDENTIALS="/Users/username/.config/secrets/credentials/service-account.json"`
- Keep backup copies of secrets files with `.backup` extension
- Store JSON credentials in `credentials/` subfolder

**direnv Workflow**
- Run `direnv allow` after creating/editing `.envrc` files
- Use `direnv reload` after modifying secrets files
- Check `direnv status` to verify what's loaded
- Use `env | grep -E "(API_KEY|TOKEN|CREDENTIALS)"` to verify secrets are loaded

## ❌ DON'T

**Anti-patterns**
- Don't use global shell exports in `.zshrc` or `.bashrc` for project secrets
- Don't mix personal and work secrets in the same file
- Don't use tilde (`~`) paths in environment variables - use full paths
- Don't commit secrets to version control in any form
- Don't use `source` or `source_env` to load entire secrets files - use `export-secret` for selective loading

**Avoid These Legacy Approaches**
- Don't use `.env` files in project roots (security risk)
- Don't use encrypted dotfile managers for frequently-changing secrets
- Don't source secrets globally in shell startup files
- Don't hardcode secrets in scripts or configuration files
- Don't source entire secrets files - only export what's needed for the project

## Integration Examples

**Using export-secret Helper**

The `~/.config/scripts/export-secret` utility selectively exports variables from secrets files:

```bash
# Usage: export-secret VARIABLE_NAME [secrets_file]
# If secrets_file is omitted, defaults to ~/.config/secrets/unito.env
```

**Personal Project `.envrc`**
```bash
# Load specific secrets from personal.env
eval "$(~/.config/scripts/export-secret TRAKT_CLIENT_ID ~/.config/secrets/personal.env)"
eval "$(~/.config/scripts/export-secret TRAKT_CLIENT_SECRET ~/.config/secrets/personal.env)"
eval "$(~/.config/scripts/export-secret TRAKT_ACCESS_TOKEN ~/.config/secrets/personal.env)"
eval "$(~/.config/scripts/export-secret TRAKT_REFRESH_TOKEN ~/.config/secrets/personal.env)"

# Project-specific settings
export PROJECT_NAME=my-project
```

**Work Project `.envrc`**
```bash
# Load work secrets (defaults to unito.env)
eval "$(~/.config/scripts/export-secret OPENAI_API_KEY)"
eval "$(~/.config/scripts/export-secret AIRTABLE_API_KEY)"

# Or specify file explicitly
eval "$(~/.config/scripts/export-secret DATABASE_URL ~/.config/secrets/unito.env)"
```

**Mixed/Sandbox Project `.envrc`**
```bash
# Load secrets from both personal and work files
eval "$(~/.config/scripts/export-secret DROPBOX_TOKEN ~/.config/secrets/personal.env)"
eval "$(~/.config/scripts/export-secret OPENAI_API_KEY ~/.config/secrets/unito.env)"

# Project settings
export ENVIRONMENT=development
```

## Troubleshooting

**Secrets not loading**
1. Check if you're in a directory with `.envrc` file
2. Run `direnv allow` to approve the `.envrc` file
3. Verify file paths are absolute (no tilde expansion issues)
4. Use `direnv status` to check loading status

**Path resolution issues**
- Use absolute paths for all file references
- Avoid shell expansion (use `/Users/username/` not `~/`)
- Check file permissions are readable

This approach provides project-isolation while maintaining organized, secure secrets management.